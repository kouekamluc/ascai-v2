# Production-focused environment template for Railway deployments.
# Copy to `.env` or add these variables in Railway → Variables.

# Core Django settings
DJANGO_SETTINGS_MODULE=config.settings.production
DEBUG=False
SECRET_KEY=django-secret--%jnP=x!MYmMvfIkHd+g4ny77Zi&gCCNOc#mLoqx2*Z4aDpsJ$

# Hosts & security
ALLOWED_HOSTS=your-app.up.railway.app
CSRF_TRUSTED_ORIGINS=https://your-app.up.railway.app

# Database (Railway normally injects DATABASE_URL automatically).
# If it does not, paste the Postgres URL here.
DATABASE_URL=postgres://username:password@host:5432/dbname

# Optional: granular DB settings if you prefer not to use DATABASE_URL.
# DB_NAME=
# DB_USER=
# DB_PASSWORD=
# DB_HOST=
# DB_PORT=5432
# DB_ENGINE=django.db.backends.postgresql

# Static & media storage (AWS S3)
# IMPORTANT: Choose ONE of the following options:

# OPTION A: Use AWS S3 (RECOMMENDED for production)
# Files are stored persistently and won't be lost on container restart.
# Set USE_S3=True and provide ALL required AWS credentials below.
USE_S3=True
AWS_ACCESS_KEY_ID=your-iam-user-access-key
AWS_SECRET_ACCESS_KEY=your-iam-user-secret
AWS_STORAGE_BUCKET_NAME=ascai-prod-media
AWS_S3_REGION_NAME=eu-central-1
# Optional but recommended: point to a CloudFront or custom domain if you have one.
# Leave blank to fall back to <bucket>.s3.<region>.amazonaws.com
AWS_S3_CUSTOM_DOMAIN=media.ascai.org
# Advanced/optional overrides (uncomment if you need them)
# AWS_S3_ENDPOINT_URL=https://s3.eu-central-1.amazonaws.com
# AWS_S3_SIGNATURE_VERSION=s3v4
# AWS_S3_ADDRESSING_STYLE=virtual

# OPTION B: Use Railway Persistent Volume (RECOMMENDED for Railway without S3)
# Files persist across container restarts using Railway's persistent volume feature.
# Set USE_S3=False and mount a Railway volume to persist media files.
USE_S3=False
# Railway Volume Configuration
# Mount path for Railway persistent volume (default: /data)
# In Railway dashboard, add a volume and mount it to this path
RAILWAY_VOLUME_MOUNT_PATH=/data

# OPTION C: Use local file storage (NOT RECOMMENDED for production)
# Files will be LOST when the container restarts on Railway.
# Only use this for testing or if you cannot set up S3 or Railway volume.
# USE_S3=False
# (No AWS credentials needed, no volume mounted)

# IMPORTANT NOTES:
# - USE_S3 accepts: "True", "true", "1", "yes", "on" (case-insensitive)
# - If USE_S3=True but AWS credentials are missing or incomplete, the application
#   will automatically fall back to local storage and log a warning. The app will
#   still start, but files will be lost on container restart.
# - Check Railway deployment logs for S3 configuration status - you'll see:
#   * "USE_S3 environment variable: '...' → parsed as: True/False"
#   * "AWS S3 configuration check:" with status of each credential
#   * "✅ AWS S3 credentials validated successfully" if all credentials are set
#   * "❌ AWS S3 is enabled but AWS credentials are missing" if credentials are missing
# - To use S3 properly, you MUST set ALL of the following when USE_S3=True:
#   * AWS_ACCESS_KEY_ID (required) - Your AWS IAM user access key
#   * AWS_SECRET_ACCESS_KEY (required) - Your AWS IAM user secret key
#   * AWS_STORAGE_BUCKET_NAME (required) - Your S3 bucket name
#   * AWS_S3_REGION_NAME (optional, defaults to us-east-1) - AWS region
#   * AWS_S3_CUSTOM_DOMAIN (optional) - Custom domain or CloudFront distribution
# - To set up AWS S3:
#   1. Create an S3 bucket in AWS Console
#   2. Create an IAM user with S3 access permissions
#   3. Generate access keys for the IAM user
#   4. Set the environment variables above in Railway
#   5. Configure S3 bucket permissions (CRITICAL - see below)
# - Check application logs to verify S3 configuration on startup
#
# S3 BUCKET PERMISSIONS SETUP (REQUIRED for Django Admin styling):
# If your Django admin panel is unstyled (no CSS), it's likely a permissions issue.
# Follow these steps to fix it:
#
# IMPORTANT: Django is configured with AWS_DEFAULT_ACL = None
# This means Django won't try to set files as "public-read" during upload.
# Instead, the bucket policy handles public access. This prevents "Access Denied"
# errors when the bucket has "Block public access" enabled.
#
# 1. BLOCK PUBLIC ACCESS SETTINGS:
#    - Go to your S3 Bucket → Permissions tab
#    - Find "Block public access (bucket settings)"
#    - You can KEEP "Block all public access" ENABLED if you want
#    - OR uncheck it if you prefer (both work with bucket policy)
#    - The bucket policy below will override block settings for specific paths
#
# 2. BUCKET POLICY (Required for public read access):
#    - Go to your S3 Bucket → Permissions tab → Bucket policy
#    - Click "Edit" and add this policy (replace YOUR-BUCKET-NAME):
#    {
#        "Version": "2012-10-17",
#        "Statement": [
#            {
#                "Sid": "PublicReadGetObject",
#                "Effect": "Allow",
#                "Principal": "*",
#                "Action": "s3:GetObject",
#                "Resource": "arn:aws:s3:::YOUR-BUCKET-NAME/*"
#            }
#        ]
#    }
#    - Save the policy
#    - This policy allows public read access to all objects in the bucket
#    - Since Django uses AWS_DEFAULT_ACL = None, files are uploaded without ACL
#    - The bucket policy then grants public access, bypassing block settings
#
# 3. VERIFY STATIC FILES ARE UPLOADED:
#    - After deployment, check your S3 bucket
#    - You should see a "static/" folder with "admin/" subfolder inside
#    - If the folder is empty, run: python manage.py collectstatic
#
# 4. DEBUGGING:
#    - Open your admin panel in browser
#    - Right-click → View Page Source
#    - Find <link rel="stylesheet" href="..."> and click the link
#    - If you see 404: Files not uploaded (run collectstatic)
#    - If you see 403: Bucket permissions are blocking access (fix permissions above)
#
# 5. IAM USER PERMISSIONS:
#    Your IAM user needs these permissions to upload files:
#    - s3:PutObject
#    - s3:GetObject
#    - s3:DeleteObject (optional, for file management)
#    - s3:ListBucket (optional, for debugging)

# Email configuration
# See EMAIL_IMPLEMENTATION_GUIDE.md for detailed setup instructions

# OPTION 1: SendGrid API (RECOMMENDED - bypasses Railway SMTP blocking)
# Just set this one variable - no SMTP config needed!
SENDGRID_API_KEY=SG.your-full-sendgrid-api-key-here
DEFAULT_FROM_EMAIL=ASCAI Lazio <noreply@ascailazio.org>
CONTACT_EMAIL=info@ascailazio.org

# OPTION 2: SendGrid SMTP (Alternative - may timeout on Railway)
# EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
# EMAIL_HOST=smtp.sendgrid.net
# EMAIL_PORT=587
# EMAIL_USE_TLS=True
# EMAIL_HOST_USER=apikey
# EMAIL_HOST_PASSWORD=SG.your-sendgrid-api-key-here

# Mailgun Configuration
# EMAIL_HOST=smtp.mailgun.org
# EMAIL_PORT=587
# EMAIL_USE_TLS=True
# EMAIL_HOST_USER=postmaster@ascailazio.org
# EMAIL_HOST_PASSWORD=your-mailgun-smtp-password

# AWS SES Configuration
# EMAIL_HOST=email-smtp.us-east-1.amazonaws.com
# EMAIL_PORT=587
# EMAIL_USE_TLS=True
# EMAIL_HOST_USER=your-aws-ses-smtp-username
# EMAIL_HOST_PASSWORD=your-aws-ses-smtp-password

# Gmail SMTP Configuration (For testing only - not recommended for production)
# EMAIL_HOST=smtp.gmail.com
# EMAIL_PORT=587
# EMAIL_USE_TLS=True
# EMAIL_HOST_USER=your-email@gmail.com
# EMAIL_HOST_PASSWORD=your-16-char-app-password

# Default values (update with your provider's settings above)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=noreply@example.com
EMAIL_HOST_PASSWORD=app-password-or-token
DEFAULT_FROM_EMAIL=ASCAI Lazio <noreply@ascailazio.org>
CONTACT_EMAIL=info@ascailazio.org

# Localization
DEFAULT_LANGUAGE=en

# Trusted domain used by Django-Allauth emails/links
SITE_DOMAIN=your-app.up.railway.app

# Google OAuth2 Configuration
# To set up Google OAuth:
# 1. Go to https://console.cloud.google.com/
# 2. Create a new project or select an existing one
# 3. Enable Google+ API (or Google Identity API)
# 4. Go to "Credentials" → "Create Credentials" → "OAuth client ID"
# 5. Choose "Web application"
# 6. Add authorized redirect URIs:
#    - For development: http://localhost:8000/accounts/google/login/callback/
#    - For production: https://your-app.up.railway.app/accounts/google/login/callback/
# 7. Copy the Client ID and Client Secret below
# 
# NOTE: You can use either naming convention:
#   - GOOGLE_CLIENT_ID / GOOGLE_CLIENT_SECRET (shorter)
#   - GOOGLE_OAUTH2_CLIENT_ID / GOOGLE_OAUTH2_CLIENT_SECRET (more explicit)
# Both are supported for flexibility.
GOOGLE_CLIENT_ID=your-google-oauth2-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-oauth2-client-secret
# Alternative naming (also supported):
# GOOGLE_OAUTH2_CLIENT_ID=your-google-oauth2-client-id.apps.googleusercontent.com
# GOOGLE_OAUTH2_CLIENT_SECRET=your-google-oauth2-client-secret

# File Upload Configuration
# All file uploads (images, documents, videos) are handled automatically:
# - When USE_S3=True: Files are uploaded to S3 bucket under 'media/' prefix
# - When USE_S3=False: Files are stored locally (will be lost on container restart)
# 
# Supported file types:
# - Images: .jpg, .jpeg, .png, .gif, .webp, .svg
# - Documents: .pdf, .doc, .docx, .xls, .xlsx, .txt, .rtf, .odt
# - Videos: .mp4, .webm, .ogg, .mov
# 
# File upload locations in S3 (when USE_S3=True):
# - User avatars: media/profiles/
# - User documents: media/user_documents/YYYY/MM/
# - Gallery images: media/gallery/images/
# - Gallery videos: media/gallery/videos/
# - News/Events images: media/news/, media/events/
# - Story images: media/story_images/YYYY/MM/
# - Group files: media/group_files/YYYY/MM/
# - University logos: media/universities/logos/
# - Scholarship documents: media/scholarships/requirements/
# - CKEditor uploads: media/uploads/
# - Admin uploads: All admin file uploads go to their respective paths
# 
# Maximum file size: 50 MB (configurable via MAX_UPLOAD_SIZE)
# 
# All uploads work for both regular users and admin users.
# Files are accessible via: https://your-bucket.s3.region.amazonaws.com/media/path/to/file

# Django Extensions should not run any DEBUG-only middleware in production.

