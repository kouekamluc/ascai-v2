{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans 'E-mail Addresses' %} - ASCAI Lazio{% endblock %}

{% block content %}
<div class="min-h-[calc(100vh-200px)] flex items-center justify-center px-4 sm:px-6 lg:px-8 py-12 bg-gradient-to-br from-gray-50 via-white to-cameroon-green/5">
    <div class="w-full max-w-2xl">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-100">
            <!-- Header -->
            <div class="bg-gradient-to-r from-cameroon-green to-cameroon-green/80 px-8 py-6 text-center">
                <h1 class="text-3xl font-bold text-white mb-2">{% trans "E-mail Addresses" %}</h1>
                <p class="text-cameroon-green/90 text-sm">{% trans "Manage your email addresses" %}</p>
            </div>
            
            <div class="px-8 py-8">
                {% if messages %}
                    {% for message in messages %}
                        <div class="mb-4 p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 border-l-4 border-red-500 text-red-700{% elif message.tags == 'success' %}bg-green-50 border-l-4 border-green-500 text-green-700{% else %}bg-blue-50 border-l-4 border-blue-500 text-blue-700{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}

                {% if user.emailaddress_set.all %}
                    <p class="text-gray-700 mb-6">{% trans 'The following e-mail addresses are associated with your account:' %}</p>

                    <form action="{% url 'account_email' %}" class="email_list" method="post">
                        {% csrf_token %}
                        
                        <div class="space-y-3 mb-6">
                            {% for emailaddress in user.emailaddress_set.all %}
                                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" 
                                               name="email" 
                                               id="email_radio_{{ forloop.counter }}"
                                               {% if emailaddress.primary or user.emailaddress_set.count == 1 %}checked="checked"{% endif %} 
                                               value="{{ emailaddress.email }}"
                                               class="w-4 h-4 text-cameroon-green focus:ring-cameroon-green border-gray-300"/>
                                        <label for="email_radio_{{ forloop.counter }}" class="cursor-pointer flex-1">
                                            <div class="flex items-center space-x-2">
                                                <strong class="text-gray-800">{{ emailaddress.email }}</strong>
                                                
                                                {% if emailaddress.verified %}
                                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                        {% trans "Verified" %}
                                                    </span>
                                                {% else %}
                                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                        {% trans "Unverified" %}
                                                    </span>
                                                {% endif %}
                                                
                                                {% if emailaddress.primary %}
                                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                                        {% trans "Primary" %}
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3">
                            <button class="flex-1 py-2 px-4 bg-cameroon-green text-white font-semibold rounded-lg hover:bg-cameroon-green/90 transition focus:outline-none focus:ring-2 focus:ring-cameroon-green focus:ring-offset-2" 
                                    type="submit" 
                                    name="action_send">
                                {% trans 'Re-send Verification' %}
                            </button>
                            <button class="flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2" 
                                    type="submit" 
                                    name="action_remove">
                                {% trans 'Remove' %}
                            </button>
                        </div>
                    </form>

                {% else %}
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg mb-6">
                        <p class="text-yellow-700">
                            {% trans 'Warning:' %} 
                            {% trans 'You currently do not have any e-mail address set up. You should really add an e-mail address so you can receive notifications, reset your password, etc.' %}
                        </p>
                    </div>
                {% endif %}

                <hr class="my-8 border-gray-200">

                <h2 class="text-2xl font-bold text-gray-800 mb-4">{% trans "Add E-mail Address" %}</h2>
                <form method="post" action="{% url 'account_email' %}" class="add_email space-y-4">
                    {% csrf_token %}
                    
                    <div>
                        <label for="id_email" class="block text-sm font-semibold text-gray-700 mb-2">
                            {% trans 'E-mail address' %}
                        </label>
                        <input type="email" 
                               name="email" 
                               id="id_email" 
                               required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cameroon-green focus:border-cameroon-green"
                               placeholder="{% trans 'Enter your email address' %}">
                        {% if form.email.errors %}
                            <p class="text-red-600 text-sm mt-1">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <button class="w-full py-2 px-4 bg-cameroon-green text-white font-semibold rounded-lg hover:bg-cameroon-green/90 transition focus:outline-none focus:ring-2 focus:ring-cameroon-green focus:ring-offset-2" 
                            name="action_add" 
                            type="submit">
                        {% trans "Add E-mail" %}
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
(function() {
  var message = "{% trans 'Do you really want to remove the selected e-mail address?' %}";
  var actions = document.getElementsByName('action_remove');
  if (actions.length) {
    actions[0].addEventListener("click", function(e) {
      if (! confirm(message)) {
        e.preventDefault();
      }
    });
  }
})();
</script>
{% endblock %}
